import{_ as x,u as C,c as a,b as i,a as d,t as h,n,F as p,e as f,h as w,o,d as R,r as g,w as b,j as k,v as S,k as D,f as z}from"./index-DioUgQHd.js";import{S as A,E as M}from"./Error-C5mMsYYM.js";import{I}from"./Item-C6WkvU7u.js";const T={data(){return{item:{},cartStore:null,platforms:[],selectedPlatform:null}},components:{Error:M,Success:A},created(){this.cartStore=C()},methods:{async fetchDetail(){try{const s=this.$route.params.slug,e=await this.$axios.get("http://localhost/GameSpace/endpoints/fetch/singleItem.php",{params:{slug:s},withCredentials:!1});this.item=e.data}catch{}},addToCart(){this.cartStore.add(this.item.id,this.selectedPlatform)},async fetchPlatform(){try{const s=await this.$axios.get("http://localhost/GameSpace/endpoints/fetch/fetchPlatforms.php",{params:{slug:this.$route.params.slug},withCredentials:!1});this.platforms=Array.isArray(s.data)?s.data:[],this.platforms.length>0&&(this.selectedPlatform=this.platforms[0].platform_id)}catch{}},titleBetterFormat(){const s=this.$route.params.slug;if(!s)return"";const e=s.split("-"),u=[];for(let v=0;v<e.length;v++){let t=e[v];t=t.charAt(0).toUpperCase()+t.slice(1),u.push(t)}return u.join(" ")}},mounted(){this.fetchDetail(),this.fetchPlatform(),document.title=this.titleBetterFormat()},computed:{selectedPlatformData(){return this.platforms.find(s=>Number(s.platform_id)===Number(this.selectedPlatform))},isPlatformIndependent(){return this.platforms.some(s=>s.name==="Platform Independent")},selectedPlatformStock(){return this.selectedPlatformData?Number(this.selectedPlatformData.stock):0},isAvailable(){return this.selectedPlatformStock>0}},watch:{"$route.params.slug"(){this.fetchDetail(),this.fetchPlatform(),document.title=this.titleBetterFormat()}}},L={class:"img_desc"},U=["src","alt"],N={class:"desc"},G={class:"price_available"},B={class:"price"},V={key:0,class:"platforms"},j=["onClick"],E=["disabled"];function F(s,e,u,v,t,l){return o(),a("div",L,[i("img",{src:t.item.image,alt:t.item.alt,loading:"lazy"},null,8,U),i("div",N,[i("h1",null,h(t.item.name),1),i("p",null,h(t.item.description),1),i("div",G,[i("p",{class:n({available:l.isAvailable,not_available:!l.isAvailable})},h(l.isAvailable?"Na sklade":"Nie je na sklade"),3),i("p",B,h(t.item.price)+"€",1)]),l.isPlatformIndependent?d("",!0):(o(),a("div",V,[(o(!0),a(p,null,f(t.platforms,m=>(o(),a("button",{key:m.platform_id,class:n([{active:t.selectedPlatform===m.platform_id},"platform"]),onClick:y=>t.selectedPlatform=m.platform_id},h(m.name),11,j))),128))])),i("button",{disabled:!l.isAvailable,onClick:e[0]||(e[0]=(...m)=>l.addToCart&&l.addToCart(...m)),class:n({notAvailable:!l.isAvailable})},[...e[1]||(e[1]=[i("i",{class:"fas fa-shopping-cart"},null,-1),w(" Do Košíka",-1)])],10,E)])])}const q=x(T,[["render",F],["__scopeId","data-v-3084e897"]]),H={props:["item"],components:{ItemDetail:q,Item:I},data(){return{showDescription:!0,res:{},recommended_products:[],reviews:[],recommendedScrollPosition:0,maxScrollLeft:0,review_limit:10,reviews_max:0,actual_page:1,userStore:null,userAddReviewRating:-1,hasUserPostedReview:null,review_text:"",show_form:!1,editMode:!1,editRating:-1,editReviewText:""}},methods:{onScroll(s){const e=s.target;this.recommendedScrollPosition=e.scrollLeft},scrollRight(){this.$el.querySelector(".recommended_products").scrollBy({left:200,behavior:"smooth"})},scrollLeft(){this.$el.querySelector(".recommended_products").scrollBy({left:-200,behavior:"smooth"})},async fetchDesc(){try{const s=this.$route.params.slug,e=await this.$axios.get("http://localhost/GameSpace/endpoints/fetch/fetch_item_html_desc.php",{params:{slug:s},withCredentials:!1});this.res=e.data}catch{}},async recommendedProducts(){try{const s=this.$route.params.slug,e=await this.$axios.get("http://localhost/GameSpace/endpoints/fetch/fetch_recommended_products.php",{params:{slug:s},withCredentials:!1});this.recommended_products=e.data,this.$nextTick(()=>{const u=this.$el.querySelector(".recommended_products");this.maxScrollLeft=u.scrollWidth-u.clientWidth})}catch{}},async fetchReviews(){const s=this.$route.params.slug,e=await this.$axios.get("http://localhost/GameSpace/endpoints/fetch/fetch_reviews.php",{params:{slug:s,limit:this.review_limit,offset:(this.actual_page-1)*this.review_limit},withCredentials:!1});this.reviews=e.data},async getMaxReviews(){try{const s=this.$route.params.slug;return(await this.$axios.get("http://localhost/GameSpace/endpoints/fetch/count_reviews.php",{params:{slug:s},withCredentials:!1})).data.total_reviews}catch{}},async addReview(){try{if(this.review_text===""||this.userAddReviewRating===-1)return;const s=await this.$axios.post("http://localhost/GameSpace/endpoints/fetch/addReview.php",{text:this.review_text,rating:this.userAddReviewRating,slug:this.$route.params.slug},{withCredentials:!0});this.fetchReviews(),this.hasUserPostedReview=-1,this.userAddReviewRating=-1,this.review_text="",this.show_form=!1}catch{}},async postedReview(){try{const s=this.$route.params.slug,e=await this.$axios.post("http://localhost/GameSpace/endpoints/fetch/has_user_posted_review.php",{slug:s},{withCredentials:!0});this.hasUserPostedReview=e.data.hasPosted}catch{this.hasUserPostedReview=!1}},async editReview(){try{if(!this.editReviewText||this.editRating===-1){alert("Recenzia nesmie byť prázdna !");return}const s=await this.$axios.post("http://localhost/GameSpace/endpoints/update/save_review.php",{rating:this.editRating,text:this.editReviewText,slug:this.$route.params.slug},{withCredentials:!0});this.editMode=!1,this.fetchReviews(),s.data.message==="success"?alert("Recenzia bola úspešne upravená !"):alert("Nastala chyba pri úprave recenzie !")}catch{}},async deleteUserReview(){try{const s=await this.$axios.post("http://localhost/GameSpace/endpoints/delete/delete_user_review.php",{slug:this.$route.params.slug},{withCredentials:!0});this.fetchReviews(),this.hasUserPostedReview=!1}catch{}},async deleteReview(){confirm("Naozaj chcete vymazať túto recenziu ?")&&await this.deleteUserReview()},setEdit(s,e){this.editMode=!this.editMode,this.editRating=s,this.editReviewText=e}},created(){this.userStore=D()},async mounted(){await this.fetchDesc(),await this.recommendedProducts(),await this.fetchReviews(),this.reviews_max=await this.getMaxReviews(),this.postedReview()},watch:{actual_page(){this.fetchReviews()}}},W={class:"item-detail-page"},K={class:"hr_wrapp"},O={class:"wrapper"},Z={class:"tab_content"},J={key:0,class:"tab desc_tab"},Q=["innerHTML"],X={key:1,class:"reviews"},Y={key:1},$={key:2,class:"add_review"},ee={for:"text"},te={class:"rating"},se=["onClick"],ie={key:3},re={class:"name_icons"},oe={key:0,class:"icons"},ae=["onClick"],le={class:"rating"},ne=["onClick"],ce={key:0},de={class:"pagination"},he=["onClick"],me={class:"title_arrows"},ue={class:"arrows"};function pe(s,e,u,v,t,l){const m=g("ItemDetail"),y=g("RouterLink"),P=g("Item");return o(),a("div",W,[R(m),i("div",K,[e[17]||(e[17]=i("hr",null,null,-1)),i("div",O,[i("button",{onClick:e[0]||(e[0]=r=>t.showDescription=!0),class:n({active:t.showDescription})},"Popis",2),i("button",{onClick:e[1]||(e[1]=r=>t.showDescription=!1),class:n({active:!t.showDescription})},"Recenzie",2)]),i("div",Z,[t.showDescription?(o(),a("div",J,[e[11]||(e[11]=i("h1",null,"Popis produktu",-1)),i("p",{innerHTML:t.res.html_description},null,8,Q)])):(o(),a("div",X,[t.userStore.user_id&&!t.hasUserPostedReview?(o(),a("button",{key:0,class:n([{active:t.show_form},"show_form"]),onClick:e[2]||(e[2]=r=>t.show_form=!t.show_form)}," Pridať recenziu ",2)):d("",!0),t.userStore.user_id?d("",!0):(o(),a("p",Y,[e[13]||(e[13]=w(" Chcete pridať recenziu ? ",-1)),R(y,{class:"login",to:{name:"login"}},{default:b(()=>[...e[12]||(e[12]=[w("Prihláste sa",-1)])]),_:1})])),t.show_form&&t.userStore.user_id?(o(),a("div",$,[e[15]||(e[15]=i("h2",null,"Pridať recenziu",-1)),i("label",ee,[e[14]||(e[14]=w("Popis: ",-1)),k(i("textarea",{id:"text",placeholder:"Zadajte text recenzie...","onUpdate:modelValue":e[3]||(e[3]=r=>t.review_text=r)},null,512),[[S,t.review_text]])]),i("div",te,[(o(),a(p,null,f(5,r=>i("i",{key:r,onClick:_=>t.userAddReviewRating=r,class:n(r<=t.userAddReviewRating?"fas fa-star yellow_star":"far fa-star empty_star")},null,10,se)),64))]),i("button",{onClick:e[4]||(e[4]=r=>l.addReview())},"Pridať recenziu")])):d("",!0),t.reviews.length==0?(o(),a("p",ie,"Neboli pridané žiadne užívateľské recenzie.")):(o(!0),a(p,{key:4},f(t.reviews,(r,_)=>(o(),a("div",{class:"review_box",key:_},[i("div",re,[i("h3",null,h(r.name)+" "+h(r.last_name),1),t.userStore.user_id?(o(),a("div",oe,[i("i",{class:"fas fa-edit",onClick:c=>l.setEdit(r.rating,r.description)},null,8,ae),i("i",{class:"fas fa-trash",onClick:e[5]||(e[5]=c=>l.deleteReview())})])):d("",!0)]),i("div",le,[t.editMode?d("",!0):(o(),a(p,{key:0},f(5,c=>i("i",{key:c,class:n(c<=r.rating?"fas fa-star yellow_star":"far fa-star empty_star")},null,2)),64)),t.editMode?(o(),a(p,{key:1},f(5,c=>i("i",{key:c,onClick:fe=>t.editRating=c,class:n(c<=t.editRating?"fas fa-star yellow_star":"far fa-star empty_star")},null,10,ne)),64)):d("",!0)]),t.editMode?d("",!0):(o(),a("p",ce,h(r.description),1)),t.editMode?k((o(),a("textarea",{key:1,type:"text",value:"","onUpdate:modelValue":e[6]||(e[6]=c=>t.editReviewText=c)},null,512)),[[S,t.editReviewText]]):d("",!0),t.editMode?(o(),a("button",{key:2,onClick:e[7]||(e[7]=c=>l.editReview())},"Upraviť recenziu")):d("",!0)]))),128)),e[16]||(e[16]=i("hr",null,null,-1)),i("div",de,[(o(!0),a(p,null,f(Math.ceil(t.reviews_max/t.review_limit),r=>(o(),a("p",{key:r,class:n({active:t.actual_page===r}),onClick:_=>t.actual_page=r},h(r),11,he))),128))])]))])]),i("div",me,[e[18]||(e[18]=i("h1",null,"Odporúčané produkty",-1)),i("div",ue,[i("i",{class:n(["fas fa-arrow-left",{active:t.recommendedScrollPosition>0,disabled:t.recommendedScrollPosition<=0}]),onClick:e[8]||(e[8]=(...r)=>l.scrollLeft&&l.scrollLeft(...r))},null,2),i("i",{class:n(["fas fa-arrow-right",{active:t.recommendedScrollPosition<t.maxScrollLeft,disabled:t.recommendedScrollPosition>=t.maxScrollLeft-20}]),onClick:e[9]||(e[9]=(...r)=>l.scrollRight&&l.scrollRight(...r))},null,2)])]),i("div",{class:"recommended_products",onScroll:e[10]||(e[10]=(...r)=>l.onScroll&&l.onScroll(...r))},[(o(!0),a(p,null,f(t.recommended_products,(r,_)=>(o(),z(P,{key:_,item:r,"parent-route-name":"item-detail"},null,8,["item"]))),128))],32)])}const ge=x(H,[["render",pe],["__scopeId","data-v-ee9aa0f5"]]);export{ge as default};
