import{_ as x,u as b,c as a,b as s,a as c,t as h,h as v,F as p,e as u,n as d,o,d as y,r as g,w as P,j as R,v as k,k as D,f as z}from"./index-CyFD_r_B.js";import{S as M,E as L}from"./Error-BfkMljii.js";import{I as T}from"./Item-CJrvsO9i.js";const U={data(){return{item:{},cartStore:null,reskey:0,platforms:[]}},components:{Error:L,Success:M},created(){this.cartStore=b()},methods:{async fetchDetail(){try{const i=this.$route.params.slug,e=await this.$axios.get("http://localhost/GameSpace/endpoints/fetch/singleItem.php",{params:{slug:i},withCredentials:!1});this.item=e.data}catch{}},addToCart(i){this.cartStore.add(i),this.reskey++},async fetchPlatform(){try{const i=await this.$axios.get("http://localhost/GameSpace/endpoints/fetch/fetchPlatforms.php",{params:{slug:this.$route.params.slug},withCredentials:!1});this.platforms=i.data}catch{}}},mounted(){this.fetchDetail(),this.fetchPlatform()},watch:{"$route.params.slug"(){this.fetchDetail()}}},I={class:"img_desc"},G=["src","alt"],N={class:"desc"},V={class:"platform"},A={class:"price_available"},B={class:"price"};function E(i,e,w,S,t,l){return o(),a("div",I,[s("img",{src:t.item.image,alt:t.item.alt,loading:"lazy"},null,8,G),s("div",N,[s("h1",null,h(t.item.name),1),s("p",null,h(t.item.description),1),s("p",V,[e[1]||(e[1]=v("Platforma: ",-1)),(o(!0),a(p,null,u(t.platforms,(f,_)=>(o(),a("p",{key:_},h(f.name?.toUpperCase()),1))),128))]),s("div",A,[s("p",{class:d({available:t.item.available==="Na sklade",not_available:t.item.available==="Nie je na sklade"})},h(t.item.available),3),s("p",B,h(t.item.price)+"€",1)]),t.item.available==="Na sklade"?(o(),a("button",{key:0,onClick:e[0]||(e[0]=f=>l.addToCart(t.item.id))},[...e[2]||(e[2]=[s("i",{class:"fas fa-shopping-cart"},null,-1),v("Do Košíka",-1)])])):c("",!0)])])}const j=x(U,[["render",E],["__scopeId","data-v-f7e4f65f"]]),q={props:["item"],components:{ItemDetail:j,Item:T},data(){return{showDescription:!0,res:{},recommended_products:[],reviews:[],recommendedScrollPosition:0,maxScrollLeft:0,review_limit:10,reviews_max:0,actual_page:1,userStore:null,userAddReviewRating:-1,hasUserPostedReview:null,review_text:"",show_form:!1,editMode:!1,editRating:-1,editReviewText:""}},methods:{onScroll(i){const e=i.target;this.recommendedScrollPosition=e.scrollLeft},scrollRight(){this.$el.querySelector(".recommended_products").scrollBy({left:200,behavior:"smooth"})},scrollLeft(){this.$el.querySelector(".recommended_products").scrollBy({left:-200,behavior:"smooth"})},async fetchDesc(){try{const i=this.$route.params.slug,e=await this.$axios.get("http://localhost/GameSpace/endpoints/fetch/fetch_item_html_desc.php",{params:{slug:i},withCredentials:!1});this.res=e.data}catch{}},async recommendedProducts(){try{const i=this.$route.params.slug,e=await this.$axios.get("http://localhost/GameSpace/endpoints/fetch/fetch_recommended_products.php",{params:{slug:i},withCredentials:!1});this.recommended_products=e.data,this.$nextTick(()=>{const w=this.$el.querySelector(".recommended_products");this.maxScrollLeft=w.scrollWidth-w.clientWidth})}catch{}},async fetchReviews(){const i=this.$route.params.slug,e=await this.$axios.get("http://localhost/GameSpace/endpoints/fetch/fetch_reviews.php",{params:{slug:i,limit:this.review_limit,offset:(this.actual_page-1)*this.review_limit},withCredentials:!1});this.reviews=e.data},async getMaxReviews(){try{const i=this.$route.params.slug;return(await this.$axios.get("http://localhost/GameSpace/endpoints/fetch/count_reviews.php",{params:{slug:i},withCredentials:!1})).data.total_reviews}catch{}},async addReview(){try{if(this.review_text===""||this.userAddReviewRating===-1)return;const i=await this.$axios.post("http://localhost/GameSpace/endpoints/fetch/addReview.php",{text:this.review_text,rating:this.userAddReviewRating,slug:this.$route.params.slug},{withCredentials:!0});this.fetchReviews(),this.hasUserPostedReview=-1,this.userAddReviewRating=-1,this.review_text="",this.show_form=!1}catch{}},async postedReview(){try{const i=this.$route.params.slug,e=await this.$axios.post("http://localhost/GameSpace/endpoints/fetch/has_user_posted_review.php",{slug:i},{withCredentials:!0});this.hasUserPostedReview=e.data.hasPosted}catch{this.hasUserPostedReview=!1}},async editReview(){try{if(!this.editReviewText||this.editRating===-1){alert("Recenzia nesmie byť prázdna !");return}const i=await this.$axios.post("http://localhost/GameSpace/endpoints/update/save_review.php",{rating:this.editRating,text:this.editReviewText,slug:this.$route.params.slug},{withCredentials:!0});this.editMode=!1,this.fetchReviews(),i.data.message==="success"?alert("Recenzia bola úspešne upravená !"):alert("Nastala chyba pri úprave recenzie !")}catch{}},async deleteUserReview(){try{const i=await this.$axios.post("http://localhost/GameSpace/endpoints/delete/delete_user_review.php",{slug:this.$route.params.slug},{withCredentials:!0});this.fetchReviews(),this.hasUserPostedReview=!1}catch{}},async deleteReview(){confirm("Naozaj chcete vymazať túto recenziu ?")&&await this.deleteUserReview()},setEdit(i,e){this.editMode=!this.editMode,this.editRating=i,this.editReviewText=e}},created(){this.userStore=D()},async mounted(){await this.fetchDesc(),await this.recommendedProducts(),await this.fetchReviews(),this.reviews_max=await this.getMaxReviews(),this.postedReview()},watch:{actual_page(){this.fetchReviews()}}},F={class:"item-detail-page"},H={class:"hr_wrapp"},W={class:"wrapper"},K={class:"tab_content"},O={key:0,class:"tab desc_tab"},Z=["innerHTML"],J={key:1,class:"reviews"},Q={key:1},X={key:2,class:"add_review"},Y={for:"text"},$={class:"rating"},ee=["onClick"],te={key:3},se={class:"name_icons"},ie={key:0,class:"icons"},re=["onClick"],oe={class:"rating"},ae=["onClick"],le={key:0},ne={class:"pagination"},ce=["onClick"],de={class:"title_arrows"},he={class:"arrows"};function pe(i,e,w,S,t,l){const f=g("ItemDetail"),_=g("RouterLink"),C=g("Item");return o(),a("div",F,[y(f),s("div",H,[e[17]||(e[17]=s("hr",null,null,-1)),s("div",W,[s("button",{onClick:e[0]||(e[0]=r=>t.showDescription=!0),class:d({active:t.showDescription})},"Popis",2),s("button",{onClick:e[1]||(e[1]=r=>t.showDescription=!1),class:d({active:!t.showDescription})},"Recenzie",2)]),s("div",K,[t.showDescription?(o(),a("div",O,[e[11]||(e[11]=s("h1",null,"Popis produktu",-1)),s("p",{innerHTML:t.res.html_description},null,8,Z)])):(o(),a("div",J,[t.userStore.user_id&&!t.hasUserPostedReview?(o(),a("button",{key:0,class:d([{active:t.show_form},"show_form"]),onClick:e[2]||(e[2]=r=>t.show_form=!t.show_form)}," Pridať recenziu ",2)):c("",!0),t.userStore.user_id?c("",!0):(o(),a("p",Q,[e[13]||(e[13]=v(" Chcete pridať recenziu ? ",-1)),y(_,{class:"login",to:{name:"login"}},{default:P(()=>[...e[12]||(e[12]=[v("Prihláste sa",-1)])]),_:1})])),t.show_form&&t.userStore.user_id?(o(),a("div",X,[e[15]||(e[15]=s("h2",null,"Pridať recenziu",-1)),s("label",Y,[e[14]||(e[14]=v("Popis: ",-1)),R(s("textarea",{id:"text",placeholder:"Zadajte text recenzie...","onUpdate:modelValue":e[3]||(e[3]=r=>t.review_text=r)},null,512),[[k,t.review_text]])]),s("div",$,[(o(),a(p,null,u(5,r=>s("i",{key:r,onClick:m=>t.userAddReviewRating=r,class:d(r<=t.userAddReviewRating?"fas fa-star yellow_star":"far fa-star empty_star")},null,10,ee)),64))]),s("button",{onClick:e[4]||(e[4]=r=>l.addReview())},"Pridať recenziu")])):c("",!0),t.reviews.length==0?(o(),a("p",te,"Neboli pridané žiadne užívateľské recenzie.")):(o(!0),a(p,{key:4},u(t.reviews,(r,m)=>(o(),a("div",{class:"review_box",key:m},[s("div",se,[s("h3",null,h(r.name)+" "+h(r.last_name),1),t.userStore.user_id?(o(),a("div",ie,[s("i",{class:"fas fa-edit",onClick:n=>l.setEdit(r.rating,r.description)},null,8,re),s("i",{class:"fas fa-trash",onClick:e[5]||(e[5]=n=>l.deleteReview())})])):c("",!0)]),s("div",oe,[t.editMode?c("",!0):(o(),a(p,{key:0},u(5,n=>s("i",{key:n,class:d(n<=r.rating?"fas fa-star yellow_star":"far fa-star empty_star")},null,2)),64)),t.editMode?(o(),a(p,{key:1},u(5,n=>s("i",{key:n,onClick:ue=>t.editRating=n,class:d(n<=t.editRating?"fas fa-star yellow_star":"far fa-star empty_star")},null,10,ae)),64)):c("",!0)]),t.editMode?c("",!0):(o(),a("p",le,h(r.description),1)),t.editMode?R((o(),a("textarea",{key:1,type:"text",value:"","onUpdate:modelValue":e[6]||(e[6]=n=>t.editReviewText=n)},null,512)),[[k,t.editReviewText]]):c("",!0),t.editMode?(o(),a("button",{key:2,onClick:e[7]||(e[7]=n=>l.editReview())},"Upraviť recenziu")):c("",!0)]))),128)),e[16]||(e[16]=s("hr",null,null,-1)),s("div",ne,[(o(!0),a(p,null,u(Math.ceil(t.reviews_max/t.review_limit),r=>(o(),a("p",{key:r,class:d({active:t.actual_page===r}),onClick:m=>t.actual_page=r},h(r),11,ce))),128))])]))])]),s("div",de,[e[18]||(e[18]=s("h1",null,"Odporúčané produkty",-1)),s("div",he,[s("i",{class:d(["fas fa-arrow-left",{active:t.recommendedScrollPosition>0,disabled:t.recommendedScrollPosition<=0}]),onClick:e[8]||(e[8]=(...r)=>l.scrollLeft&&l.scrollLeft(...r))},null,2),s("i",{class:d(["fas fa-arrow-right",{active:t.recommendedScrollPosition<t.maxScrollLeft,disabled:t.recommendedScrollPosition>=t.maxScrollLeft-20}]),onClick:e[9]||(e[9]=(...r)=>l.scrollRight&&l.scrollRight(...r))},null,2)])]),s("div",{class:"recommended_products",onScroll:e[10]||(e[10]=(...r)=>l.onScroll&&l.onScroll(...r))},[(o(!0),a(p,null,u(t.recommended_products,(r,m)=>(o(),z(C,{key:m,item:r,"parent-route-name":"item-detail"},null,8,["item"]))),128))],32)])}const fe=x(q,[["render",pe],["__scopeId","data-v-d9f27aff"]]);export{fe as default};
